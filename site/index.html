<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>SignedByMe ‚Äî Enterprise Test Portal</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Arial, sans-serif;
      margin: 0;
      padding: 24px;
      background: linear-gradient(180deg, #F7FAFF 0%, #F0F5FE 50%, #E6F0FC 100%);
      min-height: 100vh;
      color: #1f2937;
    }
    h1 {
      font-size: 32px;
      margin: 0 0 8px;
      background: linear-gradient(90deg, #3B82F6, #8B5CF6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .subtitle {
      color: #6b7280;
      margin-bottom: 24px;
    }
    .card {
      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 16px;
      padding: 24px;
      margin: 16px 0;
      max-width: 600px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }
    .card h2 {
      margin: 0 0 16px;
      font-size: 18px;
      background: linear-gradient(90deg, #3B82F6, #8B5CF6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .form-group {
      margin: 12px 0;
    }
    label {
      display: block;
      font-size: 13px;
      color: #6b7280;
      margin-bottom: 4px;
      font-weight: 500;
    }
    input, select, textarea {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      background: #f9fafb;
      color: #1f2937;
      font-size: 14px;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #3B82F6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    .btn {
      appearance: none;
      border: none;
      background: linear-gradient(90deg, #3B82F6, #8B5CF6);
      color: #fff;
      font-weight: 600;
      border-radius: 10px;
      padding: 12px 20px;
      cursor: pointer;
      font-size: 14px;
      margin: 4px 4px 4px 0;
      transition: opacity 0.2s, transform 0.1s;
    }
    .btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    .btn:active {
      transform: translateY(0);
    }
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    .btn-secondary {
      background: #f3f4f6;
      color: #4b5563;
    }
    .btn-secondary:hover {
      background: #e5e7eb;
    }
    .btn-success {
      background: linear-gradient(90deg, #10B981, #059669);
    }
    .btn-strike {
      background: linear-gradient(90deg, #00D632, #00B82B);
    }
    .qr-container {
      text-align: center;
      padding: 24px;
      background: #fff;
      border-radius: 16px;
      display: inline-block;
      margin: 16px 0;
      border: 1px solid #e5e7eb;
    }
    .status {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      font-size: 13px;
      padding: 14px;
      background: #f9fafb;
      border-radius: 10px;
      margin: 12px 0;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 300px;
      overflow-y: auto;
      border: 1px solid #e5e7eb;
    }
    .status.success { 
      border-left: 4px solid #10B981; 
      background: rgba(16, 185, 129, 0.05);
    }
    .status.error { 
      border-left: 4px solid #EF4444; 
      background: rgba(239, 68, 68, 0.05);
    }
    .status.pending { 
      border-left: 4px solid #F59E0B; 
      background: rgba(245, 158, 11, 0.05);
    }
    .hidden { display: none; }
    .step-indicator {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      max-width: 600px;
    }
    .step {
      flex: 1;
      padding: 10px 8px;
      text-align: center;
      background: #f3f4f6;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 500;
      color: #6b7280;
      border: 1px solid #e5e7eb;
    }
    .step.active {
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
      border: 1px solid #3B82F6;
      color: #3B82F6;
    }
    .step.done {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid #10B981;
      color: #10B981;
    }
    .deep-link {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 8px;
      word-break: break-all;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
    }
    .invoice-box {
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.05), rgba(139, 92, 246, 0.05));
      border: 1px solid #3B82F6;
      border-radius: 10px;
      padding: 16px;
      margin: 12px 0;
    }
    .invoice-box code {
      font-size: 11px;
      word-break: break-all;
      color: #3B82F6;
    }
    .logo-container {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }
    .logo {
      width: 48px;
      height: 48px;
      background: linear-gradient(135deg, #3B82F6, #8B5CF6);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }
    .strike-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #000;
      color: #00D632;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
    }
    .amount-display {
      font-size: 32px;
      font-weight: 700;
      background: linear-gradient(90deg, #3B82F6, #8B5CF6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .sats-label {
      font-size: 14px;
      color: #6b7280;
      margin-left: 4px;
    }
  </style>
</head>
<body>
  <div class="logo-container">
    <div class="logo">‚ö°</div>
    <div>
      <h1>SignedByMe</h1>
      <p class="subtitle" style="margin: 0;">Enterprise Test Portal</p>
    </div>
  </div>

  <!-- Step Indicator -->
  <div class="step-indicator">
    <div class="step" id="step1">1. Create Session</div>
    <div class="step" id="step2">2. User Scans</div>
    <div class="step" id="step3">3. Pay Invoice</div>
    <div class="step" id="step4">4. Verified ‚úì</div>
  </div>

  <!-- Card 1: Create Session -->
  <div class="card" id="card-create">
    <h2>üè¢ Create Login Session</h2>
    <p style="font-size: 13px; color: #6b7280;">As an enterprise, create a session for user authentication. The user will receive sats when they log in!</p>
    
    <div class="form-group">
      <label>Enterprise Name</label>
      <input type="text" id="enterprise-name" value="Acme Corp" />
    </div>
    
    <div class="form-group">
      <label>Amount (sats) ‚Äî User will receive this</label>
      <input type="number" id="amount-sats" value="100" min="1" />
    </div>
    
    <div class="form-group">
      <label>Strike API Key (optional ‚Äî enables real payments)</label>
      <input type="password" id="strike-api-key" placeholder="sk_live_..." />
      <small style="color: #9ca3af; font-size: 11px;">Get your key at <a href="https://dashboard.strike.me" target="_blank" style="color: #3B82F6;">dashboard.strike.me</a></small>
    </div>
    
    <button class="btn" id="btn-create-session">Create Session & Show QR</button>
    
    <div id="status-create" class="status hidden"></div>
  </div>

  <!-- Card 2: QR Code Display -->
  <div class="card hidden" id="card-qr">
    <h2>üì± Scan with SignedByMe App</h2>
    <p style="font-size: 13px; color: #6b7280;">User scans this QR code with the SignedByMe mobile app.</p>
    
    <div style="text-align: center;">
      <div id="qr-container" class="qr-container"></div>
    </div>
    
    <p class="deep-link" id="deep-link"></p>
    
    <div style="margin-top: 12px;">
      <button class="btn btn-secondary" id="btn-copy-link">üìã Copy Deep Link</button>
      <button class="btn btn-secondary" id="btn-new-session">üîÑ New Session</button>
    </div>
    
    <div id="status-waiting" class="status pending">Waiting for user to scan and submit invoice...</div>
  </div>

  <!-- Card 3: Invoice Received -->
  <div class="card hidden" id="card-invoice">
    <h2>‚ö° Invoice Received</h2>
    <p style="font-size: 13px; color: #6b7280;">User submitted their Lightning invoice. Pay it to verify their identity!</p>
    
    <div style="text-align: center; margin: 20px 0;">
      <span class="amount-display" id="amount-display">100</span>
      <span class="sats-label">sats</span>
    </div>
    
    <div class="invoice-box">
      <label>Lightning Invoice</label>
      <code id="invoice-display"></code>
    </div>
    
    <div class="form-group">
      <label>User DID</label>
      <input type="text" id="user-did" readonly />
    </div>
    
    <div class="form-group">
      <label>Verification Status</label>
      <input type="text" id="stwo-status" readonly />
    </div>
    
    <div id="strike-pay-section" class="hidden" style="margin: 20px 0; padding: 16px; background: #000; border-radius: 10px;">
      <div style="display: flex; align-items: center; justify-content: space-between;">
        <span class="strike-badge">‚ö° Strike</span>
        <button class="btn btn-strike" id="btn-strike-pay">Pay with Strike</button>
      </div>
      <p style="color: #9ca3af; font-size: 12px; margin: 8px 0 0;">Real Lightning payment via Strike API</p>
    </div>
    
    <div id="manual-pay-section">
      <p style="font-size: 13px; color: #6b7280; margin-top: 16px;">
        Pay this invoice with any Lightning wallet, then enter the preimage:
      </p>
      
      <div class="form-group">
        <label>Payment Preimage (hex, 64 chars)</label>
        <input type="text" id="preimage-input" placeholder="Enter preimage after paying..." />
      </div>
      
      <button class="btn" id="btn-confirm">Confirm Payment</button>
      <button class="btn btn-secondary" id="btn-simulate-pay">üß™ Simulate (Test)</button>
    </div>
    
    <div id="status-invoice" class="status hidden"></div>
  </div>

  <!-- Card 4: Verified -->
  <div class="card hidden" id="card-verified">
    <h2>‚úÖ Identity Verified!</h2>
    <p style="font-size: 13px; color: #6b7280;">User has been authenticated and received their sats.</p>
    
    <div style="text-align: center; padding: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 10px; margin: 16px 0;">
      <div style="font-size: 48px; margin-bottom: 8px;">üéâ</div>
      <div style="color: #10B981; font-weight: 600;">Payment Confirmed</div>
      <div style="color: #6b7280; font-size: 13px;">User received sats & identity verified</div>
    </div>
    
    <div class="form-group">
      <label>ID Token (JWT) ‚Äî Use this to authenticate the user</label>
      <textarea id="id-token" readonly style="height: 100px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace; font-size: 11px;"></textarea>
    </div>
    
    <button class="btn btn-secondary" id="btn-decode-token">üîç Decode Token</button>
    <button class="btn" id="btn-start-over">Start Over</button>
    
    <div id="status-verified" class="status success hidden"></div>
  </div>

  <!-- API Status -->
  <div class="card">
    <h2>üîß API Status</h2>
    <button class="btn btn-secondary" id="btn-health">Check Health</button>
    <button class="btn btn-secondary" id="btn-info">API Info</button>
    <div id="api-status" class="status hidden"></div>
  </div>

  <p style="font-size: 12px; color: #9ca3af; margin-top: 32px; max-width: 600px;">
    API: <strong style="color: #6b7280;">api.beta.privacy-lion.com</strong> | 
    <a href="https://github.com/PrivacyLion/btc-did" style="color: #3B82F6;">GitHub</a>
  </p>

  <script src="qrcode.min.js"></script>
  <script src="enterprise-demo.js"></script>
</body>
</html>
